<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-56107651-4"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-56107651-4');
        </script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/async/3.2.0/async.min.js"></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>  
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <title>Covid-19 Projection Nepal</title>
        <style>
            .container_viewport {position: relative; height:70vh; width:60vw}
            @media only screen and (max-width: 768px) {
              .container_viewport {position: relative; height:70vh; width:100vw}
            }
            div.jumbotron {
              background-color: whitesmoke;
            }
            #button-group {
              margin: auto;
              display: flex;
              flex-direction: row;
              justify-content: center;
            }
        </style>
    </head>
    <body>
    

      <div class="container">
          <div class="col-sm-10" style="background-color:white;">
            <div class="jumbotron" align="center">
              <img src="nepalflag.png" alt="Flag of Nepal" height="60">
              <h1>Covid-19 Projection for Nepal</h1>
            </div> 
        </div>
      </div>

        <!-- projection -->
      <div class="container container_viewport mb-2" id="projection">
      <div class="dropdown" align="center">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" id='selectedRegion'>Select Region
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a href="#" onclick="updateRegion('National');">Whole Nepal</a></li>
          <li><a href="#" onclick="updateRegion('Province-1');">Province 1</a></li>
          <li><a href="#" onclick="updateRegion('Province-2');">Province 2</a></li>
          <li><a href="#" onclick="updateRegion('Province-3');">Province 3</a></li>
          <li><a href="#" onclick="updateRegion('Province-4');">Province 4</a></li>
          <li><a href="#" onclick="updateRegion('Province-5');">Province 5</a></li>
          <li><a href="#" onclick="updateRegion('Province-6');">Province 6</a></li>
          <li><a href="#" onclick="updateRegion('Province-7');">Province 7</a></li>
        </ul>
      </div>

    </br>

    <div class="row">
      <div class="col-md-12 text-center">
        <div class="btn-group flex-wrap">
          <button type="button" id='btn_infected'class="btn btn-outline-primary" onclick="updateDisplayAndType('Total Infected', 'infected');">Infected</button>
          <button type="button" id='btn_chilam' class="btn btn-outline-primary" onclick="updateDisplayAndType('Cumulative Deaths', 'chilam');">Death</button>
          <button type="button" id='btn_chilamPerDay' class="btn btn-outline-primary" onclick="updateDisplayAndType('Deaths per day', 'chilamPerDay');">Death/day</button>
          <button type="button" id='btn_recovered' class="btn btn-outline-primary" onclick="updateDisplayAndType('Total Recovered', 'recovered');">Recovered</button>
       </div>
      </div>
    </div>
    </br>

    <canvas id="myChart"></canvas>
  </br>
</br>


<div class="container"></div>

<hr>
  

<div class="container">
  <h3>About us</h3>

  This project was created by a team of Nepali scholars together with a large number of experts within and outside of Nepal.
</br>
    <li> Birendra Adhikari (Senior Chemical Engineer, USA) </li>
    <li> Vaskar Dahal (Data Scientist, USA) </li>
    <li> Suraj Pathak (Entrepreneur, Singapore/Australia) </li>
    <li> Dinesh Neupane (Public Health Expert, Nepal Development Society) </li>
  <br> 
  For a detailed list of contributors, please refer our full manuscript. 
</div>


  
  <hr>

  <div class="container">
    <button type="button" id='btn_methods'class="btn btn-primary" onclick="location.href='methods.html'">Methods</button>
    <br>
    <br>
    <button type="button" id='btn_methods'class="btn btn-primary" onclick="location.href='datasource.html'">Data Source</button>
    <br>
    <br>
    <button type="button" id='btn_methods'class="btn btn-primary" onclick="location.href='additional.html'">Other Resources</button>
  </div>

</br>
<hr>
</br>
  <h3>Disclaimer</h3>
  The above displayed data and predictions are results of estimation and modelling. Please contact us before using our data for major decisions. 




</div>



</div>



    <!-- Content -->

    <script>
    var current_region = "National";
    var current_display_name = "Total Infected";
    var current_csv_type = "infected";
    refresh();

    function updateRegion(region) {
      current_region = region;
      refresh();
    }

    function updateDisplayAndType(display, type) {
      current_display_name = display;
      current_csv_type = type;
      document.getElementById('btn_chilam').aria_pressed='true';
      refresh();
    }
        
    function refresh() {
      plotChartType(current_display_name, current_region, current_csv_type, 'myChart');
    }


    function plotChartType(display_name, region, data_type_in_csv, plot_id){
    var data_no_mitigation = [];
    var data_50_mitigation = [];
    var data_75_mitigation = [];
    var data_90_mitigation = [];

    function readCSV(name, store_at, callback) {
      console.log("called read csv");
      d3.csv(name).then(function(data) {
      data.forEach(function(d) {
        let x = +d.day;
        let y = +d[data_type_in_csv]/1000;
        store_at.push({x: x,y: y});
      });
      callback();
      });
   }
  
  async.parallel([
    function(callback) { readCSV('/scripts/data/'+region+'_No.csv', data_no_mitigation, callback); },
    function(callback) { readCSV('/scripts/data/'+region+'_50.csv', data_50_mitigation, callback); },
    function(callback) { readCSV('/scripts/data/'+region+'_75.csv', data_75_mitigation, callback); },
    function(callback) { readCSV('/scripts/data/'+region+'_90.csv', data_90_mitigation, callback); }
  ], function done(err, results) {
    console.log("loaded all csv");
    console.log(data_no_mitigation[20]);
    console.log(data_90_mitigation[100]);
    plotChart();
  });

  function plotChart() {
    let myChart = document.getElementById(plot_id).getContext('2d');
    // Global Options
    Chart.defaults.global.defaultFontFamily = 'Lato';
    Chart.defaults.global.defaultFontSize = 18;
    Chart.defaults.global.defaultFontColor = '#777';

    let massPopChart = new Chart(myChart, {
      type: 'scatter', // bar, horizontalBar, pie, line, doughnut, radar, polarArea
      data:{
        datasets:[
          {
          label:'No mitigation',
          data: data_no_mitigation,
          borderColor:'red',
          borderWidth: 2,
          fill: false,
          pointRadius: 0
          },
          {
          label:'50% mitigation',
          data: data_50_mitigation,
          borderColor:'yellow',
          borderWidth: 2,
          fill: false,
          pointRadius: 0
          },
          {
          label:'75% mitigation',
          data: data_75_mitigation,
          borderColor:'blue',
          borderWidth: 2,
          fill: false,
          pointRadius: 0
          },
          {
          label:'90% mitigation',
          data: data_90_mitigation,
          borderColor:'green',
          borderWidth: 2,
          fill: false,
          pointRadius: 0
          },
        ]
      },
      options:{
        maintainAspectRatio: false,
        scales: {
          xAxes: [{
            scaleLabel: {
              display: true,
              labelString: 'Days since 1st infection'
            }
          }],
          yAxes: [{
            scaleLabel: {
              display: true,
              labelString: 'Population (in thousand)'
            }
          }]
        },
        title:{
          display:true,
          text: display_name + ' (' + region + ')',
          fontSize:25
        },
        legend:{
          display:true,
          position:'top',
          labels:{
            fontColor:'#000'
          }
        },
        layout:{
          padding:{
            left:0,
            right:0,
            bottom:0,
            top:0
          }
        },
        tooltips:{
          enabled:true
        }
      }
    });
  }
}
    </script>
  </body>
</html>
